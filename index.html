<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Click & Shop - Vente de montres, gadgets et articles de mode à Abidjan</title>
    <meta name="description" content="Votre boutique en ligne à Abidjan. Découvrez nos articles de mode, montres et gadgets uniques en promotion. Commande facile via WhatsApp et paiement mobile.">

    <!-- Favicon -->
    <link rel="icon" href="https://i.postimg.cc/HstHYQt1/487226401-548004051650400-2403234004967527102-n.jpg" type="image/jpeg">

    <!-- Meta Tags pour le partage sur les réseaux sociaux (Open Graph) -->
    <meta property="og:title" content="Click & Shop - Votre boutique en ligne">
    <meta property="og:description" content="Parcourez notre sélection d'articles uniques et tendance. Contactez-nous en un clic pour commander.">
    <meta property="og:image" content="https://i.postimg.cc/HstHYQt1/487226401-548004051650400-2403234004967527102-n.jpg">
    <meta property="og:url" content="https://VOTRE-FUTUR-SITE.com"> <!-- Remplacez par votre vrai nom de domaine -->
    <meta property="og:type" content="website">
    
    <!-- TailwindCSS & Google Fonts & Font Awesome -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Librairie pour lire les fichiers CSV -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; scroll-behavior: smooth; }
        .transition-all { transition: all 0.3s ease-in-out; }
        .hidden-truly { display: none; }
        /* Animation pour le toast */
        .toast-enter { opacity: 0; transform: translateY(20px); }
        .toast-exit { opacity: 0; transform: translateY(20px); }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- =========== HEADER / EN-TÊTE =========== -->
    <header class="bg-white shadow-md sticky top-0 z-40">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
            <a href="#" id="logo-container" class="flex items-center" title="Cliquez 5 fois pour révéler l'accès admin">
                <img src="https://i.postimg.cc/HstHYQt1/487226401-548004051650400-2403234004967527102-n.jpg" alt="Logo Click & Shop" class="h-12 w-12 mr-3 rounded-full object-cover">
                <span class="font-extrabold text-2xl text-gray-800">Click & Shop</span>
            </a>
            <div class="flex items-center space-x-4">
                <a href="#articles" class="text-gray-600 hover:text-orange-500 transition-all">Nos Articles</a>
                <a href="#contact" class="text-gray-600 hover:text-orange-500 transition-all">Contact</a>
                <button id="admin-btn" class="hidden-truly bg-gray-800 text-white px-4 py-2 rounded-lg hover:bg-orange-500 transition-all text-sm">
                    <i class="fas fa-lock mr-2"></i>Admin
                </button>
            </div>
        </nav>
    </header>

    <!-- =========== SECTION PRINCIPALE / HÉROS =========== -->
    <main>
        <section class="container mx-auto px-6 py-16 text-center">
            <h1 class="text-4xl md:text-6xl font-extrabold leading-tight">Vos trouvailles au meilleur prix.</h1>
            <p class="mt-4 text-lg text-gray-600 max-w-2xl mx-auto">Parcourez notre sélection d'articles uniques et tendance. Contactez-nous en un clic pour commander.</p>
            <a href="#articles" class="mt-8 inline-block bg-orange-500 text-white font-bold text-lg px-8 py-4 rounded-lg shadow-lg hover:bg-orange-600 transform hover:scale-105 transition-all">
                Découvrir les articles
            </a>
        </section>

        <!-- =========== SECTION DES ARTICLES =========== -->
        <section id="articles" class="bg-white py-20">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl font-bold text-center mb-12">Nos Articles</h2>
                <div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                    <!-- Squelettes de chargement injectés ici -->
                </div>
            </div>
        </section>

        <!-- =========== SECTION CONTACT & PAIEMENT =========== -->
        <section id="contact" class="py-20">
             <div class="container mx-auto px-6 text-center">
                <h2 class="text-3xl font-bold mb-8">Contactez-nous & Moyens de Paiement</h2>
                <div class="max-w-4xl mx-auto bg-white p-8 rounded-2xl shadow-lg flex flex-col md:flex-row items-center justify-around gap-8">
                    <div class="text-center">
                        <i class="fab fa-whatsapp text-5xl text-green-500 mb-4"></i>
                        <h3 class="text-xl font-bold">Par WhatsApp</h3>
                        <p class="text-gray-600 mt-2">Pour toute question ou pour commander :</p>
                        <a href="https://wa.me/2250103112944" target="_blank" class="text-lg font-semibold text-orange-500 hover:underline mt-2 inline-block">+225 01 03 11 29 44</a>
                    </div>
                    <div class="text-center">
                        <div class="flex justify-center items-center space-x-4 mb-4">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/9/9f/Wave_logo.png" alt="Wave" class="h-10" onerror="this.style.display='none'">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b3/Orange_Money_logo.svg/2560px-Orange_Money_logo.svg.png" alt="Orange Money" class="h-12" onerror="this.style.display='none'">
                        </div>
                        <h3 class="text-xl font-bold">Paiement Mobile</h3>
                        <p class="text-gray-600 mt-2">Payez simplement via Wave ou Orange Money au :</p>
                        <p class="text-lg font-semibold text-gray-800 mt-2">+225 07 58 24 55 30</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- =========== FOOTER / PIED DE PAGE (AMÉLIORÉ) =========== -->
    <footer class="bg-gray-800 text-white">
        <div class="container mx-auto px-6 pt-16 pb-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center md:text-left">
                <!-- Colonne 1: Identité -->
                <div>
                    <div class="flex items-center justify-center md:justify-start mb-4">
                        <img src="https://i.postimg.cc/HstHYQt1/487226401-548004051650400-2403234004967527102-n.jpg" alt="Logo Click & Shop" class="h-12 w-12 mr-3 rounded-full object-cover">
                        <span class="font-extrabold text-2xl">Click & Shop</span>
                    </div>
                    <p class="text-gray-400">Vos trouvailles au meilleur prix, livrées chez vous.</p>
                </div>

                <!-- Colonne 2: Navigation -->
                <div>
                    <h3 class="font-bold text-lg mb-4 uppercase tracking-wider">Navigation</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white transition-all">Accueil</a></li>
                        <li><a href="#articles" class="text-gray-400 hover:text-white transition-all">Nos Articles</a></li>
                        <li><a href="#contact" class="text-gray-400 hover:text-white transition-all">Contact</a></li>
                    </ul>
                </div>

                <!-- Colonne 3: Contact -->
                <div>
                    <h3 class="font-bold text-lg mb-4 uppercase tracking-wider">Restons Connectés</h3>
                    <div class="flex justify-center md:justify-start space-x-6">
                        <a href="https://www.facebook.com/clickshopci" target="_blank" aria-label="Facebook" class="text-2xl hover:text-orange-500 transition-all"><i class="fab fa-facebook-square"></i></a>
                        <a href="https://wa.me/2250103112944" target="_blank" aria-label="WhatsApp" class="text-2xl hover:text-green-500 transition-all"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-12 pt-8 text-center text-gray-500 text-sm">
                <p>&copy; <span id="copyright-year"></span> Click & Shop. Tous droits réservés.</p>
            </div>
        </div>
    </footer>


    <!-- =========== MODALS & NOTIFICATIONS =========== -->
    <div id="admin-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"></div>
    <div id="delete-confirm-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4"><div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-sm text-center"><h3 class="text-lg font-bold mb-4">Confirmer la suppression</h3><p class="text-gray-600 mb-6">Êtes-vous sûr de vouloir supprimer cet article ? Cette action est irréversible.</p><div class="flex justify-center space-x-4"><button id="cancel-delete-btn" class="bg-gray-200 text-gray-800 px-6 py-2 rounded-lg hover:bg-gray-300">Annuler</button><button id="confirm-delete-btn" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">Supprimer</button></div></div></div>
    <div id="toast-container" class="fixed bottom-5 right-5 z-50 space-y-2"></div>

    <!-- =========== SCRIPT JAVASCRIPT =========== -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, addDoc, doc, updateDoc, deleteDoc, getDoc, writeBatch } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ================== CONFIGURATION FIREBASE ==================
        const firebaseConfig = {
          apiKey: "AIzaSyAqdl2EGr0YfQ4b6v8tCx5xC_I376vVHEg",
          authDomain: "clickshop-c3370.firebaseapp.com",
          projectId: "clickshop-c3370",
          storageBucket: "clickshop-c3370.appspot.com",
          messagingSenderId: "324812019414",
          appId: "1:324812019414:web:75d67a7ea2ac8fdcad5b77"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const productsCollection = collection(db, 'products');

        let allProducts = [];
        let productToDeleteId = null;

        const DOM = {
            productListContainer: document.getElementById('product-list'),
            adminModal: document.getElementById('admin-modal'),
            adminBtn: document.getElementById('admin-btn'),
            logoContainer: document.getElementById('logo-container'),
            deleteConfirmModal: document.getElementById('delete-confirm-modal'),
            cancelDeleteBtn: document.getElementById('cancel-delete-btn'),
            confirmDeleteBtn: document.getElementById('confirm-delete-btn'),
            copyrightYear: document.getElementById('copyright-year'),
        };

        function showToast(message, type = 'success') {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `transition-all duration-300 toast-enter ${type === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white font-bold py-3 px-5 rounded-lg shadow-lg`;
            toast.textContent = message;
            toastContainer.appendChild(toast);
            setTimeout(() => {
                toast.classList.add('toast-exit');
                toast.addEventListener('transitionend', () => toast.remove());
            }, 4000);
        }

        function renderSkeletons() {
            DOM.productListContainer.innerHTML = Array(4).fill('').map(() => `<div class="bg-white rounded-lg shadow-lg overflow-hidden animate-pulse"><div class="w-full h-56 bg-gray-300"></div><div class="p-6"><div class="h-6 bg-gray-300 rounded w-3/4 mb-2"></div><div class="h-4 bg-gray-300 rounded w-full mb-1"></div><div class="h-4 bg-gray-300 rounded w-5/6 mb-4"></div><div class="h-8 bg-gray-300 rounded w-1/2 mb-4"></div><div class="h-12 bg-gray-300 rounded-lg w-full"></div></div></div>`).join('');
        }

        function renderPublicProducts(products) {
            if (!products.length) { DOM.productListContainer.innerHTML = '<p class="col-span-full text-center text-gray-500">Aucun article à afficher pour le moment.</p>'; return; }
            DOM.productListContainer.innerHTML = products.map(product => {
                const isPromo = product.slashed_price && product.slashed_price > product.price;
                let promoBadge = '';
                let priceHTML = `<p class="text-2xl font-extrabold text-orange-500 mb-4">${product.price.toLocaleString('fr-FR')} FCFA</p>`;

                if (isPromo) {
                    const reduction = Math.round(((product.slashed_price - product.price) / product.slashed_price) * 100);
                    promoBadge = `<div class="absolute top-0 right-0 bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-bl-lg">-${reduction}%</div>`;
                    priceHTML = `
                        <div class="flex items-end space-x-2 mb-4">
                            <p class="text-2xl font-extrabold text-red-500">${product.price.toLocaleString('fr-FR')} FCFA</p>
                            <p class="text-lg line-through text-gray-500">${product.slashed_price.toLocaleString('fr-FR')} FCFA</p>
                        </div>
                    `;
                }

                return `
                <div class="bg-white rounded-lg shadow-lg overflow-hidden flex flex-col transform hover:-translate-y-2 transition-all">
                    <div class="relative">
                        <img src="${product.image}" alt="${product.name}" class="w-full h-56 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/ffffff?text=Image+invalide';">
                        ${promoBadge}
                    </div>
                    <div class="p-6 flex-grow flex flex-col">
                        <h3 class="text-xl font-bold mb-2">${product.name}</h3>
                        <p class="text-gray-600 mb-4 flex-grow">${product.description}</p>
                        <div class="mt-auto">
                            ${priceHTML}
                            <a href="https://wa.me/2250103112944?text=Bonjour, je suis intéressé(e) par l'article '${product.name}'" target="_blank" class="w-full text-center bg-gray-800 text-white font-bold py-3 px-4 rounded-lg hover:bg-orange-500 transition-all flex items-center justify-center">
                                <i class="fab fa-whatsapp mr-2"></i> Commander
                            </a>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        function renderAdminModalContent(isLoggedIn) {
            if (isLoggedIn) {
                DOM.adminModal.innerHTML = `
                    <div class="bg-white rounded-lg shadow-2xl p-8 w-full max-w-2xl max-h-full overflow-y-auto relative">
                        <button id="close-admin-btn" class="absolute top-4 right-4 text-2xl text-gray-500 hover:text-gray-800">&times;</button>
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">Panneau d'Administration</h2>
                            <button id="logout-btn" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 text-sm"><i class="fas fa-sign-out-alt mr-2"></i>Déconnexion</button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <button id="show-add-form-btn" class="w-full bg-green-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-600"><i class="fas fa-plus mr-2"></i>Ajouter un article</button>
                            <button id="import-csv-btn" class="w-full bg-blue-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-600"><i class="fas fa-file-csv mr-2"></i>Importer des articles</button>
                        </div>
                        <input type="file" id="csv-file-input" class="hidden" accept=".csv">

                        <div id="import-instructions" class="hidden bg-blue-50 border-l-4 border-blue-400 p-4 mb-6 text-sm">
                            <p class="font-bold">Comment importer ?</p>
                            <p class="mt-1">Utilisez un fichier CSV avec les colonnes : <code class="bg-gray-200 text-xs p-1 rounded">name</code>, <code class="bg-gray-200 text-xs p-1 rounded">price</code>, <code class="bg-gray-200 text-xs p-1 rounded">image</code>, <code class="bg-gray-200 text-xs p-1 rounded">description</code>, <code class="bg-gray-200 text-xs p-1 rounded">slashed_price</code>.</p>
                            <a href="#" id="download-template-btn" class="text-blue-600 hover:underline mt-2 inline-block">Télécharger le modèle</a>
                        </div>
                        
                        <form id="product-form" class="hidden space-y-4 bg-gray-50 p-6 rounded-lg mb-6"></form>
                        <h3 class="text-xl font-semibold mt-8 mb-4">Articles existants</h3>
                        <div id="admin-product-list" class="space-y-3"></div>
                    </div>`;
                renderAdminProducts(allProducts);
            } else {
                DOM.adminModal.innerHTML = `<div class="bg-white rounded-lg shadow-2xl p-8 w-full max-w-md max-h-full overflow-y-auto relative"><button id="close-admin-btn" class="absolute top-4 right-4 text-2xl text-gray-500 hover:text-gray-800">&times;</button><h2 class="text-2xl font-bold mb-6 text-center">Connexion Administrateur</h2><form id="login-form" class="space-y-4"><div><label for="admin-email" class="block text-sm font-medium text-gray-700">Email</label><input type="email" id="admin-email" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3" required></div><div><label for="admin-password" class="block text-sm font-medium text-gray-700">Mot de passe</label><input type="password" id="admin-password" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3" required></div><p id="login-error" class="text-red-500 text-sm text-center hidden"></p><button type="submit" class="w-full bg-orange-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-orange-600">Se connecter</button></form></div>`;
            }
            addAdminEventListeners(isLoggedIn);
        }

        function renderAdminProducts(products) {
            const container = document.getElementById('admin-product-list');
            if (!container) return;
            if (!products.length) { container.innerHTML = '<p class="text-center text-gray-500">Aucun article à gérer.</p>'; return; }
            container.innerHTML = products.map(product => {
                const isPromo = product.slashed_price && product.slashed_price > product.price;
                const priceDisplay = isPromo 
                    ? `<span class="text-red-500">${product.price.toLocaleString('fr-FR')} FCFA</span> <span class="line-through text-gray-500 text-sm">${product.slashed_price.toLocaleString('fr-FR')} FCFA</span>`
                    : `<strong>${product.price.toLocaleString('fr-FR')} FCFA</strong>`;

                return `<div class="bg-gray-100 p-3 rounded-lg flex items-center justify-between" data-id="${product.id}">
                    <div class="flex items-center truncate">
                        <img src="${product.image}" class="h-10 w-10 rounded-md object-cover mr-4 flex-shrink-0" onerror="this.onerror=null;this.src='https://placehold.co/100/ccc/fff?text=Img';">
                        <span class="truncate">${product.name} - ${priceDisplay}</span>
                    </div>
                    <div class="space-x-2 flex-shrink-0">
                        <button class="edit-btn text-blue-500 hover:text-blue-700" title="Modifier"><i class="fas fa-pencil-alt"></i></button>
                        <button class="delete-btn text-red-500 hover:text-red-700" title="Supprimer"><i class="fas fa-trash-alt"></i></button>
                    </div>
                </div>`;
            }).join('');
        }
        
        onSnapshot(productsCollection, (snapshot) => {
            allProducts = snapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));
            renderPublicProducts(allProducts);
            renderAdminProducts(allProducts);
        });

        function showProductForm(product = null) {
            document.getElementById('import-instructions')?.classList.add('hidden');
            const form = document.getElementById('product-form');
            form.innerHTML = `
                <h3 class="text-xl font-semibold text-center">${product ? "Modifier l'article" : "Ajouter un article"}</h3>
                <input type="hidden" id="product-id" value="${product ? product.id : ''}">
                <div><label for="product-name" class="block text-sm font-medium text-gray-700">Nom</label><input type="text" id="product-name" class="mt-1 block w-full" value="${product ? product.name : ''}" required></div>
                <div class="grid grid-cols-2 gap-4">
                    <div><label for="product-price" class="block text-sm font-medium text-gray-700">Prix de vente (FCFA)</label><input type="number" id="product-price" class="mt-1 block w-full" value="${product ? product.price : ''}" required></div>
                    <div><label for="product-slashed-price" class="block text-sm font-medium text-gray-700">Prix barré (Optionnel)</label><input type="number" id="product-slashed-price" class="mt-1 block w-full" value="${product && product.slashed_price ? product.slashed_price : ''}"></div>
                </div>
                <div><label for="product-image" class="block text-sm font-medium text-gray-700">URL de l'image</label><input type="url" id="product-image" class="mt-1 block w-full" value="${product ? product.image : ''}" required></div>
                <div><label for="product-description" class="block text-sm font-medium text-gray-700">Description</label><textarea id="product-description" rows="4" class="mt-1 block w-full" required>${product ? product.description : ''}</textarea></div>
                <div class="flex justify-end space-x-4"><button type="button" id="cancel-form-btn" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600">Annuler</button><button type="submit" class="bg-orange-500 text-white px-6 py-2 rounded-lg hover:bg-orange-600">Enregistrer</button></div>
            `;
            form.classList.remove('hidden');
            form.querySelector('#cancel-form-btn').addEventListener('click', () => form.classList.add('hidden'));
        }
        
        async function handleFormSubmit(e) {
            e.preventDefault();
            const id = e.target.querySelector('#product-id').value;
            const price = parseInt(e.target.querySelector('#product-price').value);
            const slashed_price = parseInt(e.target.querySelector('#product-slashed-price').value) || 0;

            const productData = { 
                name: e.target.querySelector('#product-name').value, 
                price: price, 
                slashed_price: slashed_price > price ? slashed_price : null,
                image: e.target.querySelector('#product-image').value, 
                description: e.target.querySelector('#product-description').value, 
            };

            try {
                if (id) { await updateDoc(doc(db, 'products', id), productData); showToast('Article mis à jour !'); } 
                else { await addDoc(productsCollection, productData); showToast('Article ajouté avec succès !'); }
                e.target.classList.add('hidden');
            } catch (error) { showToast("Erreur: " + error.message, 'error'); }
        }

        async function handleAdminListClick(e) {
            const button = e.target.closest('button');
            if (!button) return;
            const productElement = button.closest('[data-id]');
            const productId = productElement.dataset.id;
            if (button.classList.contains('edit-btn')) {
                const docSnap = await getDoc(doc(db, 'products', productId));
                if (docSnap.exists()) { showProductForm({ id: productId, ...docSnap.data() }); } 
                else { showToast('Article introuvable.', 'error'); }
            }
            if (button.classList.contains('delete-btn')) {
                productToDeleteId = productId;
                DOM.deleteConfirmModal.classList.remove('hidden');
            }
        }

        DOM.confirmDeleteBtn.addEventListener('click', async () => {
            if (!productToDeleteId) return;
            try { await deleteDoc(doc(db, 'products', productToDeleteId)); showToast('Article supprimé.'); } 
            catch (error) { showToast("Erreur de suppression.", 'error'); } 
            finally { productToDeleteId = null; DOM.deleteConfirmModal.classList.add('hidden'); }
        });

        onAuthStateChanged(auth, user => {
            const isLoggedIn = !!user;
            DOM.adminBtn.innerHTML = isLoggedIn ? '<i class="fas fa-cog mr-2"></i>Gérer' : '<i class="fas fa-lock mr-2"></i>Admin';
            DOM.adminBtn.classList.toggle('bg-orange-500', isLoggedIn);
            DOM.adminBtn.classList.toggle('bg-gray-800', !isLoggedIn);
        });
        
        let logoClicks = 0;
        DOM.logoContainer.addEventListener('click', () => {
            logoClicks++;
            if (logoClicks === 5) { DOM.adminBtn.classList.remove('hidden-truly'); showToast('Accès administrateur révélé.'); }
            setTimeout(() => { logoClicks = 0; }, 1500);
        });
        
        DOM.adminBtn.addEventListener('click', () => {
            renderAdminModalContent(!!auth.currentUser);
            DOM.adminModal.classList.remove('hidden');
        });

        function addAdminEventListeners(isLoggedIn) {
            document.getElementById('close-admin-btn').addEventListener('click', () => DOM.adminModal.classList.add('hidden'));
            if(isLoggedIn) {
                document.getElementById('logout-btn').addEventListener('click', () => { signOut(auth); DOM.adminModal.classList.add('hidden'); });
                document.getElementById('show-add-form-btn').addEventListener('click', () => showProductForm());
                document.getElementById('admin-product-list').addEventListener('click', handleAdminListClick);
                const form = document.getElementById('product-form');
                if (form) form.addEventListener('submit', handleFormSubmit);

                const importBtn = document.getElementById('import-csv-btn');
                const csvFileInput = document.getElementById('csv-file-input');
                const importInstructions = document.getElementById('import-instructions');
                
                importBtn.addEventListener('click', () => {
                    document.getElementById('product-form').classList.add('hidden');
                    importInstructions.classList.toggle('hidden');
                    if(!importInstructions.classList.contains('hidden')){
                        csvFileInput.click();
                    }
                });

                document.getElementById('download-template-btn').addEventListener('click', (e) => {
                    e.preventDefault();
                    const csvContent = "data:text/csv;charset=utf-8,name;price;image;description;slashed_price\nMontre de luxe;12000;https://example.com/image.jpg;Une très belle montre;15000";
                    const encodedUri = encodeURI(csvContent);
                    const link = document.createElement("a");
                    link.setAttribute("href", encodedUri);
                    link.setAttribute("download", "modele_import_articles.csv");
                    document.body.appendChild(link);
                    link.click();
                    link.remove();
                });

                csvFileInput.addEventListener('change', (event) => {
                    const file = event.target.files[0];
                    if (!file) return;

                    importBtn.disabled = true;
                    importBtn.innerHTML = `<i class="fas fa-spinner fa-spin mr-2"></i>Importation...`;

                    Papa.parse(file, {
                        header: true,
                        skipEmptyLines: true,
                        delimiter: ";",
                        complete: async (results) => {
                            const products = results.data;
                            if(!products.length || !products[0].name || !products[0].price){
                                showToast("Fichier CSV invalide ou mal formaté. Vérifiez les en-têtes.", "error");
                                importBtn.disabled = false;
                                importBtn.innerHTML = `<i class="fas fa-file-csv mr-2"></i>Importer des articles`;
                                csvFileInput.value = '';
                                return;
                            }

                            try {
                                const batch = writeBatch(db);
                                let count = 0;
                                products.forEach(product => {
                                    const { name, price, image, description, slashed_price } = product;
                                    const priceNum = parseInt(price) || 0;
                                    const slashedPriceNum = parseInt(slashed_price) || 0;
                                    if(name && priceNum) {
                                        const newProductRef = doc(collection(db, "products"));
                                        batch.set(newProductRef, {
                                            name: name.trim(),
                                            price: priceNum,
                                            image: image ? image.trim() : '',
                                            description: description ? description.trim() : '',
                                            slashed_price: slashedPriceNum > priceNum ? slashedPriceNum : null
                                        });
                                        count++;
                                    }
                                });
                                await batch.commit();
                                showToast(`${count} article(s) importé(s) avec succès !`, "success");
                            } catch (error) {
                                showToast("Erreur lors de l'importation.", "error");
                                console.error("Batch write failed: ", error);
                            } finally {
                                importBtn.disabled = false;
                                importBtn.innerHTML = `<i class="fas fa-file-csv mr-2"></i>Importer des articles`;
                                importInstructions.classList.add('hidden');
                                csvFileInput.value = '';
                            }
                        },
                        error: (error) => {
                            showToast("Erreur de lecture du fichier.", "error");
                            console.error(error);
                            importBtn.disabled = false;
                            importBtn.innerHTML = `<i class="fas fa-file-csv mr-2"></i>Importer des articles`;
                            csvFileInput.value = '';
                        }
                    });
                });
                
            } else {
                document.getElementById('login-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const [email, password, errorP] = [e.target.querySelector('#admin-email').value, e.target.querySelector('#admin-password').value, e.target.querySelector('#login-error')];
                    errorP.classList.add('hidden');
                    try {
                        await signInWithEmailAndPassword(auth, email, password);
                        renderAdminModalContent(true);
                    } catch (error) { errorP.textContent = "Email ou mot de passe incorrect."; errorP.classList.remove('hidden'); }
                });
            }
        }
        
        DOM.cancelDeleteBtn.addEventListener('click', () => DOM.deleteConfirmModal.classList.add('hidden'));
        
        // --- INITIALISATION AU CHARGEMENT DE LA PAGE ---
        function initialize() {
            DOM.copyrightYear.textContent = new Date().getFullYear();
            renderSkeletons();
        }
        
        initialize();

    </script>
</body>
</html>

